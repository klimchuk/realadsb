1 CLEAR 400
2 DIM XA$(10),XB#(10),XC#(10),XD(10),XE$(10),XF(10),XG(10),XH(10),XI$(10),XJ$(10)
5 SCREEN 0:WIDTH 80
10 PRINT "RealADSB 0.1 for MSX"
20 PRINT "--------------------"
30 CFG$="A:REALADSB.CFG":DI$="KEWR":DA#=40.6924798:DO#=-74.1686868:DP$="192.168.1.153"
40 PRINT "Loading configuration from "+CFG$+"..."
50 ON ERROR GOTO 120
60 OPEN CFG$ FOR INPUT AS #1
70 INPUT #1,DI$
80 INPUT #1,DA#
90 INPUT #1,DO#
100 INPUT #1,DP$
110 CLOSE
120 PRINT "OK"
125 PRINT "Airport ICAO code ["+DI$+"]: "
130 INPUT AI$
140 IF AI$="" THEN AI$=DI$
150 IF LEN(AI$)<4 THEN 125
155 PRINT "Your latitude ["+STR$(DA#)+"]: "
160 INPUT LA#
170 IF LA#=0 THEN LA#=DA#
175 PRINT "Your longitude ["+STR$(DO#)+"]: "
180 INPUT LO#
190 IF LO#=0 THEN LO#=DO#
195 PRINT "adsb_hub3 IP ["+DP$+"]: "
200 INPUT IP$
210 IF IP$="" THEN IP$=DP$
220 PRINT "Saving configuration to "+CFG$+"..."
230 OPEN CFG$ FOR OUTPUT AS #1
240 PRINT #1,AI$
250 PRINT #1,STR$(LA#)
260 PRINT #1,STR$(LO#)
270 PRINT #1,IP$
280 CLOSE
290 PRINT "OK"
500 OPEN "GRP:" AS #1
510 REM 512 x 212 16 colours
520 SCREEN 7,2:GOSUB 10000
530 COLOR 15,4,4:CLS
540 REM Draw radar
550 LINE (256-210,106)-(256+210,106),15
560 LINE (256,2)-(256,210),15
570 CIRCLE (256,106),105
580 CIRCLE (256,106),210
590 REM Left top corner
600 PSET(2,2),0
610 PRINT #1,"AIRPORT: "+AI$
620 PSET(2,12),0
630 PRINT #1,STR$(LA#)
640 PSET(2,22),0
650 PRINT #1,STR$(LO#)
660 REM Right bottom corner
670 PSET(435,182),0
680 PRINT #1,"M - METAR"
690 PSET(435,192),0
700 PRINT #1,"Q - Quit"
710 REM Right top corner
720 PSET(405,2),0
730 PRINT #1,IP$
740 GOSUB 3000
1000 A$=INKEY$
1010 REM Test keys M - show METAR Q - exit
1020 IF A$="M" OR A$="m" THEN 5000
1030 IF A$<>"Q" AND A$<>"q" THEN 1000
1040 END
3000 REM Get data from adsb_hub3 http://IP:5567/a
3010 ADSBHUB$="C058C0|41.105393|-74.508466|37975|ACA967|302|447|-128|B788|C-GHPV|2731|ACA"
3020 NA=0
3030 X=1:L=0:C=LEN(ADSBHUB$)
3040 N=INSTR(X,ADSBHUB$,"|"):IF N=0 AND X<C THEN N=C
3050 K$=MID$(ADSBHUB$,X,N-X)
3055 IF LEN(K$)=0 THEN 3200
3060 IF L=0 THEN XA$(NA)=K$
3070 IF L=1 THEN XB#(NA)=VAL(K$)-LA#
3070 IF L=2 THEN XC#(NA)=VAL(K$)-LO#
3080 IF L=3 THEN XD(NA)=VAL(K$)
3090 IF L=4 THEN XE$(NA)=K$
3100 IF L=5 THEN XF(NA)=VAL(K$)
3110 IF L=6 THEN XG(NA)=VAL(K$)
3120 IF L=7 THEN XH(NA)=VAL(K$)
3130 IF L=8 THEN XI$(NA)=K$
3140 IF L=9 THEN XJ$(NA)=K$
3150 X=N+1:L=L+1
3160 IF X<C THEN 3040
3170 PUT SPRITE NA,(120+INT(XC#(NA)*100.0),98-INT(XB#(NA)*100.0)),15,0
3180 NA=NA+1
3200 RETURN
5000 REM METAR
5005 PUT SPRITE 0,(-32,-32),15,0
5010 COLOR 10,1,4
5020 LINE (20,20)-(492,192),1,BF
5030 PSET(30,25),0
5040 PRINT #1,"METAR for "+AI$
5050 LINE (30,35)-(482,35),10
5060 REM Load METAR from http://tgftp.nws.noaa.gov/data/observations/metar/stations/ICAO.TXT
5070 REM U$="http://tgftp.nws.noaa.gov:80/data/observations/metar/stations/"+AI$+".TXT"
5080 REM OPEN "HTTP:U$" FOR INPUT AS #2
5070 METAR$="2022/04/09 00:51"+CHR$(13)+CHR$(10)+"KEWR 090051Z 17006KT 10SM FEW060 14/M01 A2968 RMK AO2 PK WND 30028/1340 SLP088 T00891044"
5080 X=1:L=0:C=LEN(METAR$)
5090 N=INSTR(X,METAR$,CHR$(13)):IF N=0 AND X<C THEN N=C
5100 REM Loop for long (>50) lines
5110 FOR M=0 TO INT((N-X)/50)
5120 PSET(30,40+L*10),0
5130 XL=N-X:IF XL>50 THEN XL=50
5140 PRINT #1,MID$(METAR$,X,XL)
5150 X=X+XL:L=L+1
5160 NEXT M
5170 X=N+2
5180 IF X<C THEN 5090
5200 B$=INKEY$
5210 IF B$=CHR$(27) THEN 530 
5220 GOTO 5200
10000 REM Load sprites https://www.msx.org/wiki/BASE()
10010 S=BASE(39)
10020 READ R$: IF R$="*" THEN RETURN ELSE VPOKE S,VAL("&H"+R$):S=S+1:GOTO 10020
10030 REM Sprite 16x16 airplane up
10040 DATA 00,01,01,01,01,01,07,1F,7F,79,01,01,01,03,07,00
10050 DATA 00,80,80,80,80,80,E0,F8,FE,9E,80,80,80,C0,E0,00
10060 REM Sprite 16x16 airplane right
10070 DATA 00,03,03,03,03,41,61,7F,7F,61,41,03,03,03,03,00
10080 DATA 00,00,00,80,80,C0,C0,FE,FE,C0,C0,80,80,00,00,00
10090 REM Sprite 16x16 airplane down
10100 DATA 00,07,03,01,01,01,79,7F,1F,07,01,01,01,01,01,00
10110 DATA 00,E0,C0,80,80,80,9E,FE,F8,E0,80,80,80,80,80,00
10120 REM Sprite 16x16 airplane left
10130 DATA 00,00,00,01,01,03,03,7F,7F,03,03,01,01,00,00,00
10140 DATA 00,C0,C0,C0,C0,82,86,FE,FE,86,82,C0,C0,C0,C0,00
10150 DATA *
